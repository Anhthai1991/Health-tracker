<!DOCTYPE html>
<html lang="vi" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title }} | {{ site.title }}</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e3c72">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <style>
        /* --- FULL CSS GỐC (Đã phục hồi đầy đủ) --- */
        :root {
            --bg-body: #f4f6f8;
            --bg-card: #ffffff;
            --text-main: #212529;
            --text-muted: #6c757d;
            --border-color: rgba(0,0,0,0.05);
            --input-bg: #ffffff;
            --input-border: #dee2e6;
            --table-th-bg: #f8f9fa;
            --modal-bg: #ffffff;
            --btn-close-filter: none;
        }

        [data-theme="dark"] {
            --bg-body: #121212;
            --bg-card: #1e1e1e;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --border-color: rgba(255,255,255,0.1);
            --input-bg: #2c2c2c;
            --input-border: #444;
            --table-th-bg: #2c2c2c;
            --modal-bg: #1e1e1e;
            --btn-close-filter: invert(1) grayscale(100%) brightness(200%);
        }

        body { background-color: var(--bg-body); color: var(--text-main); font-family: 'Segoe UI', sans-serif; min-height: 100vh; display: flex; flex-direction: column; transition: background-color 0.3s, color 0.3s; }
        .main-content { flex: 1; padding-top: 20px; }
        
        .card { border: none; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; background: var(--bg-card); color: var(--text-main); transition: background-color 0.3s; }
        [data-theme="dark"] .card { box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: 1px solid #333; }
        
        .header-gradient { background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 40px 0 30px; border-radius: 0 0 30px 30px; margin-bottom: 30px; }
        
        /* Class quan trọng để nút bấm đẹp như cũ */
        .tool-btn { border-radius: 12px; padding: 12px; font-weight: 600; border: none; width: 100%; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 4px rgba(0,0,0,0.05); font-size: 0.9rem; background: var(--bg-card) !important; transition: 0.3s; }
        [data-theme="dark"] .tool-btn { background: #2c2c2c !important; color: #e0e0e0 !important; box-shadow: none; border: 1px solid #444; }
        
        .form-control, .form-select { background-color: var(--input-bg); border-color: var(--input-border); color: var(--text-main); }
        .form-control:focus { background-color: var(--input-bg); color: var(--text-main); }
        [data-theme="dark"] .form-control::placeholder { color: #6c757d; }
        
        .table { color: var(--text-main); }
        .table thead th { background-color: var(--table-th-bg) !important; color: var(--text-main); border-color: var(--border-color); }
        .table td { border-color: var(--border-color); }
        
        .modal-content { background-color: var(--modal-bg); color: var(--text-main); }
        .btn-close { filter: var(--btn-close-filter); }

        .chart-legend { display: flex; justify-content: center; gap: 15px; margin-top: 10px; font-size: 0.8rem; color: var(--text-muted); }
        .legend-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        
        @media print {
            .no-print, .header-gradient, footer, .tool-btn, .search-section { display: none !important; }
            .card { box-shadow: none; border: 1px solid #ddd; page-break-inside: avoid; background: white !important; color: black !important; }
            .print-header { display: block !important; text-align: center; margin-bottom: 20px; }
            body { background: white !important; color: black !important; }
        }
        .print-header { display: none; }
    </style>
</head>
<body>

    <div class="header-gradient text-center no-print">
        <div class="container position-relative">
            <button class="btn btn-sm btn-outline-light rounded-circle position-absolute top-0 end-0 mt-0" onclick="toggleTheme()" id="themeBtn">
                <i class="bi bi-moon-fill"></i>
            </button>

            <h2 class="fw-bold" id="headerName">{{ page.title }}</h2>
            <p class="opacity-75 small">{{ site.description }}</p>
            
            <button class="btn btn-sm btn-outline-light rounded-pill px-3" data-bs-toggle="modal" data-bs-target="#keyModal">
                <i class="bi bi-key-fill"></i> Cài đặt AI
            </button>
            <div id="modelStatus" class="small mt-2 text-warning" style="font-size: 0.75em;"></div>

            {% if page.url != "/" %}
            <br>
            <a href="./" class="btn btn-sm btn-outline-light rounded-pill px-3 mt-2"><i class="bi bi-house-fill"></i> Về Dashboard</a>
            {% endif %}
        </div>
    </div>

    <div class="print-header">
        <h2>BÁO CÁO SỨC KHỎE</h2>
        <p>Ngày: <script>document.write(new Date().toLocaleDateString('vi-VN'))</script></p>
        <hr>
    </div>

    <div class="container main-content">
        {{ content }}
    </div>

    <footer class="no-print py-3 text-center mt-auto border-top" style="background: var(--bg-card); color: var(--text-muted);">
        <small>© 2025 Thai Health Tracker</small>
    </footer>

</body>
</html>