<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·ª£ L√Ω S·ª©c Kh·ªèe To√†n Di·ªán</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        .card { border: none; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .header-gradient { background: linear-gradient(120deg, #2980b9, #8e44ad); color: white; padding: 30px 0; margin-bottom: 30px; border-radius: 0 0 20px 20px; }
        .status-red { color: #e74c3c; font-weight: bold; }
        .status-yellow { color: #f1c40f; font-weight: bold; }
        .status-green { color: #27ae60; font-weight: bold; }
        .search-box { border: 2px solid #3498db; border-radius: 25px; padding: 10px 20px; width: 100%; }
        .tip-icon { font-size: 1.5rem; margin-right: 10px; color: #3498db; }
    </style>
</head>
<body>

    <div class="header-gradient text-center">
        <div class="container">
            <h1>H·ªì S∆° S·ª©c Kh·ªèe: Nguy·ªÖn Anh Th√°i</h1>
            <p class="opacity-75">Ki·ªÉm so√°t Gout - D·∫° d√†y - Men gan - Th·∫≠n</p>
        </div>
    </div>

    <div class="container">
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card p-4">
                    <h4 class="text-primary mb-3"><i class="bi bi-search"></i> Tra c·ª©u nhanh th·ª±c ph·∫©m</h4>
                    <input type="text" id="foodSearch" class="search-box" placeholder="Nh·∫≠p t√™n th·ª±c ph·∫©m (v√≠ d·ª•: B√≤, G√†, Bia, Tr·ª©ng...)" onkeyup="searchFood()">
                    <div id="searchResult" class="mt-3">
                        <p class="text-muted small">Nh·∫≠p t√™n m√≥n ƒÉn ƒë·ªÉ xem AI t∆∞ v·∫•n c√≥ n√™n ƒÉn hay kh√¥ng.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card p-4">
                    <h4 class="text-success mb-3"><i class="bi bi-clock-history"></i> L·ªãch Tr√¨nh Sinh Ho·∫°t Khuy·∫øn Ngh·ªã</h4>
                    <div class="row" id="lifestyleTips">
                        </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card p-3">
                    <h5><i class="bi bi-graph-up"></i> Di·ªÖn bi·∫øn s·ª©c kh·ªèe</h5>
                    <canvas id="labChart"></canvas>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card p-3 h-100 text-center bg-white">
                    <h5>U·ªëng n∆∞·ªõc h√¥m nay</h5>
                    <h1 class="display-1 fw-bold text-info" id="waterTarget">--</h1>
                    <p class="text-muted" id="waterNote">...</p>
                    <hr>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary" onclick="alert('ƒê√£ ghi nh·∫≠n 1 ly n∆∞·ªõc!')">+ 1 Ly (250ml)</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="card p-3">
                    <h5>Nh·∫≠t k√Ω ƒÇn u·ªëng & ƒê√°nh gi√°</h5>
                    <table class="table table-hover">
                        <thead>
                            <tr><th>Ng√†y</th><th>B·ªØa ƒÉn</th><th>ƒê√°nh gi√°</th></tr>
                        </thead>
                        <tbody id="mealTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let foodDB = [];

        fetch('data.json')
            .then(response => response.json())
            .then(data => {
                foodDB = data.food_database;
                renderLifestyle(data.lifestyle_tips);
                renderLabChart(data.medical_checkups);
                calculateWater(data.medical_checkups[data.medical_checkups.length - 1]);
                renderMeals(data.meal_logs);
            });

        // 1. H√†m t√¨m ki·∫øm th·ª±c ph·∫©m
        function searchFood() {
            const input = document.getElementById('foodSearch').value.toLowerCase();
            const resultDiv = document.getElementById('searchResult');
            resultDiv.innerHTML = '';

            if (input.length < 2) return;

            const results = foodDB.filter(item => item.name.toLowerCase().includes(input));

            if (results.length > 0) {
                results.forEach(item => {
                    let icon = item.status === 'green' ? 'üü¢ ƒê∆∞·ª£c ƒÉn' : (item.status === 'yellow' ? 'üü° H·∫°n ch·∫ø' : 'üî¥ Tr√°nh xa');
                    let colorClass = item.status === 'green' ? 'alert-success' : (item.status === 'yellow' ? 'alert-warning' : 'alert-danger');
                    
                    resultDiv.innerHTML += `
                        <div class="alert ${colorClass} d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${icon}: ${item.name}</strong><br>
                                <small>${item.reason}</small>
                            </div>
                        </div>`;
                });
            } else {
                resultDiv.innerHTML = '<p class="text-muted">Kh√¥ng t√¨m th·∫•y trong c∆° s·ªü d·ªØ li·ªáu. H√£y th·ª≠ t·ª´ kh√≥a kh√°c.</p>';
            }
        }

        // 2. H√†m hi·ªÉn th·ªã L·ªãch tr√¨nh
        function renderLifestyle(tips) {
            const container = document.getElementById('lifestyleTips');
            container.innerHTML = `
                <div class="col-md-3 border-end"><i class="bi bi-brightness-alt-high tip-icon"></i><strong>S√°ng:</strong><br>${tips.morning}</div>
                <div class="col-md-3 border-end"><i class="bi bi-cup-hot tip-icon"></i><strong>ƒÇn u·ªëng:</strong><br>${tips.eating}</div>
                <div class="col-md-3 border-end"><i class="bi bi-moon-stars tip-icon"></i><strong>T·ªëi:</strong><br>${tips.evening}</div>
                <div class="col-md-3"><i class="bi bi-bicycle tip-icon"></i><strong>V·∫≠n ƒë·ªông:</strong><br>${tips.exercise}</div>
            `;
        }

        // 3. H√†m t√≠nh n∆∞·ªõc
        function calculateWater(latest) {
            let amount = 2.0;
            if(latest.uric_acid > 400 || latest.alt_liver > 40) amount = 3.0;
            document.getElementById('waterTarget').innerText = amount + "L";
            document.getElementById('waterNote').innerText = latest.uric_acid > 360 ? "TƒÉng n∆∞·ªõc ƒë·ªÉ th·∫£i Acid Uric" : "Duy tr√¨ m·ª©c c∆° b·∫£n";
        }

        // 4. V·∫Ω bi·ªÉu ƒë·ªì
        function renderLabChart(logs) {
            const ctx = document.getElementById('labChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: logs.map(l => l.date),
                    datasets: [
                        { label: 'Gout (Uric Acid)', data: logs.map(l => l.uric_acid), borderColor: '#e74c3c', tension: 0.4 },
                        { label: 'Men gan (ALT)', data: logs.map(l => l.alt_liver), borderColor: '#f1c40f', tension: 0.4 }
                    ]
                },
                options: { responsive: true }
            });
        }

        function renderMeals(logs) {
            // Code render meal log (nh∆∞ c≈©)
             const tbody = document.getElementById('mealTable');
            logs.slice().reverse().forEach(log => {
                tbody.innerHTML += `<tr><td>${log.date}</td><td>${log.content}</td><td>${log.evaluation}</td></tr>`;
            });
        }
    </script>
</body>
</html>