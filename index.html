<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Tracker - Gout & Kidney Care</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f8f9fa; }
        .card { margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: none; }
        .highlight-bad { color: red; font-weight: bold; }
        .highlight-good { color: green; font-weight: bold; }
        .warning-box { background-color: #fff3cd; padding: 10px; border-radius: 5px; border-left: 5px solid #ffc107;}
    </style>
</head>
<body>
    <div class="container py-4">
        <h1 class="mb-4 text-center text-primary">Hồ Sơ Sức Khỏe Cá Nhân</h1>
        
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="warning-box">
                    <strong>Lưu ý y tế:</strong> Bạn đang theo dõi Gout, Dạ dày (GERD/HP) và Thận. 
                    Nếu chỉ số <em>eGFR < 60</em> hoặc <em>Uric Acid > 420</em>, hãy chú ý đặc biệt.
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="card p-3">
                    <h5>Theo Dõi Cân Nặng (Hàng tuần)</h5>
                    <canvas id="weightChart"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card p-3">
                    <h5>Chỉ Số Xét Nghiệm (3 tháng/lần)</h5>
                    <canvas id="labChart"></canvas>
                    <small class="text-muted mt-2">*Uric Acid (umol/L) và Creatinine (umol/L)</small>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <div class="card p-3">
                    <h5 class="text-success">Chế Độ Ăn Uống</h5>
                    <p><strong>Mục tiêu Calo:</strong> <span id="calTarget">...</span> kcal/ngày</p>
                    <hr>
                    <h6>Nên tránh (Gout/GERD):</h6>
                    <ul id="avoidList" class="text-danger small"></ul>
                    <h6>Nên ăn:</h6>
                    <ul id="recList" class="text-success small"></ul>
                    <div class="alert alert-info small mt-2" id="dietRules"></div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="card p-3">
                    <h5>Nhật Ký Bữa Ăn & Đánh Giá</h5>
                    <table class="table table-striped table-hover small">
                        <thead>
                            <tr>
                                <th>Ngày</th>
                                <th>Bữa ăn</th>
                                <th>Đánh giá (AI)</th>
                            </tr>
                        </thead>
                        <tbody id="mealTable">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Hàm lấy dữ liệu từ file JSON
        fetch('data.json')
            .then(response => response.json())
            .then(data => {
                renderProfile(data.profile, data.diet_advice);
                renderWeightChart(data.weight_log);
                renderLabChart(data.medical_checkups);
                renderMeals(data.meal_logs);
            });

        function renderProfile(profile, advice) {
            document.getElementById('calTarget').innerText = profile.daily_calories_target;
            document.getElementById('dietRules').innerText = advice.rules;
            
            const avoidList = document.getElementById('avoidList');
            advice.avoid.forEach(item => {
                let li = document.createElement('li');
                li.innerText = item;
                avoidList.appendChild(li);
            });

            const recList = document.getElementById('recList');
            advice.recommended.forEach(item => {
                let li = document.createElement('li');
                li.innerText = item;
                recList.appendChild(li);
            });
        }

        function renderWeightChart(logs) {
            const ctx = document.getElementById('weightChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: logs.map(l => l.date),
                    datasets: [{
                        label: 'Cân nặng (kg)',
                        data: logs.map(l => l.value),
                        borderColor: '#0d6efd',
                        tension: 0.1
                    }]
                }
            });
        }

        function renderLabChart(logs) {
            const ctx = document.getElementById('labChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: logs.map(l => l.date),
                    datasets: [
                        {
                            label: 'Uric Acid (Gout)',
                            data: logs.map(l => l.uric_acid),
                            backgroundColor: 'rgba(255, 99, 132, 0.5)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Creatinine (Thận)',
                            data: logs.map(l => l.creatinine),
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        function renderMeals(logs) {
            const tbody = document.getElementById('mealTable');
            // Lấy 5 dòng mới nhất
            logs.slice().reverse().slice(0, 5).forEach(log => {
                let row = `<tr>
                    <td>${log.date}</td>
                    <td>${log.content}</td>
                    <td><em>${log.evaluation}</em></td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }
    </script>
</body>
</html>
